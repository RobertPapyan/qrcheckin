<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/dashboard_layout}">
<body>
<main layout:fragment="content" th:object="${updateProfileRequest}" class="grow">
    <div th:if="${updateProfileRequest}" class="bg-white  shadow-lg rounded-xl p-6 size-full text-center space-y-4">
        <h1 class="font-semibold text-slate-600 text-center">Edit profile</h1>
        <form th:action="@{/dashboard/profile/update}"
              method="post" enctype="multipart/form-data"
              class="p-6 bg-white  rounded-xl overflow-hidden w-full">

           <div class="flex gap-4 items-center">
               <div>
                   <img th:if="${user.image}" th:src="@{'/public/images/' + ${user.image}}" alt="Profile Image"
                        class="w-24 h-24 rounded-full object-cover">
                   <svg th:if="${user.image == null }"  class="w-24 h-24 rounded-full" xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="1"  stroke-linecap="round"  stroke-linejoin="round"  ><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0" /><path d="M12 10m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0" /><path d="M6.168 18.849a4 4 0 0 1 3.832 -2.849h4a4 4 0 0 1 3.834 2.855" /></svg>
                   <!-- For sending false instead of null -->
                   <input type="hidden" name="delete-image" th:value="false">
                   <div th:if="${user.image}" class="flex">
                       <input th:field="*{delete_image}" type="checkbox" name="delete-image" class="shrink-0 mt-0.5 border-gray-200 rounded-sm text-blue-600 focus:ring-blue-500 checked:border-blue-500 disabled:opacity-50 disabled:pointer-events-none " id="delete-image">
                       <label for="delete-image" class="text-sm text-gray-500 ms-3 ">Delete image</label>
                   </div>
               </div>

               <div class="mt-4">
                   <label class="block text-sm font-medium mb-2">Change Profile Image</label>
                   <input type="file" accept="image/*" name="image"  th:field="*{image}"
                          class="block w-full border border-gray-200 rounded-lg text-sm focus:border-blue-500 focus:ring-blue-500 file:bg-gray-50 file:border-0 file:py-2 file:px-4"/>
                   <p th:if="${#fields.hasErrors('image')}" th:errors="*{image}"
                       class="text-red-600 text-sm mt-1"></p>
               </div>
           </div>


            <!-- Name & Surname -->
            <div class="flex gap-2 mt-4">
                <div class="w-1/2">
                    <label class="block text-sm font-medium mb-2">Name</label>
                    <input type="text" th:field="*{name}" placeholder="John"
                           class="py-2.5 px-4 block w-full border border-gray-200 rounded-lg sm:text-sm focus:border-blue-500 focus:ring-blue-500"/>
                    <p th:if="${#fields.hasErrors('name')}" th:errors="*{name}"
                       class="text-red-600 text-sm mt-1"></p>
                </div>
                <div class="w-1/2">
                    <label class="block text-sm font-medium mb-2">Surname</label>
                    <input type="text" th:field="*{surname}" placeholder="Smith"
                           class="py-2.5 px-4 block w-full border border-gray-200 rounded-lg sm:text-sm focus:border-blue-500 focus:ring-blue-500"/>
                    <p th:if="${#fields.hasErrors('surname')}" th:errors="*{surname}"
                       class="text-red-600 text-sm mt-1"></p>
                </div>
            </div>

            <!-- Email -->
            <div class="mt-4">
                <label class="block text-sm font-medium mb-2">Email</label>
                <input type="email" th:field="*{email}" placeholder="you@example.com"
                       class="py-2.5 px-4 block w-full border border-gray-200 rounded-lg sm:text-sm focus:border-blue-500 focus:ring-blue-500"/>
               <p th:if="${#fields.hasErrors('email')}" th:errors="*{email}"
                   class="text-red-600 text-sm mt-1"></p>
            </div>

            <div class="flex gap-2 mt-4">
                <!-- New Password -->
                <div class="mt-4 w-1/2">
                    <label class="block text-sm font-medium mb-2">New Password</label>
                    <input name="password" type="password"  placeholder="••••••••"
                           class="py-2.5 px-4 block w-full border border-gray-200 rounded-lg sm:text-sm focus:border-blue-500 focus:ring-blue-500"/>
                    <p th:if="${#fields.hasErrors('password')}" th:errors="*{password}"
                       class="text-red-600 text-sm mt-1"></p>
                </div>

                <!-- Confirm Password -->
                <div class="mt-4 w-1/2">
                    <label class="block text-sm font-medium mb-2">Confirm Password</label>
                    <input name="password_repeat" type="password"  placeholder="••••••••"
                           class="py-2.5 px-4 block w-full border border-gray-200 rounded-lg sm:text-sm focus:border-blue-500 focus:ring-blue-500"/>
                    <p th:if="${#fields.hasErrors('password_repeat')}" th:errors="*{password_repeat}"
                       class="text-red-600 text-sm mt-1"></p>
                </div>
            </div>
            <!-- Global errors -->
            <div th:if="${#fields.hasGlobalErrors()}" class="text-red-600 text-sm mb-2">
                <ul>
                    <li th:each="err : ${#fields.globalErrors()}" th:text="${err}"></li>
                </ul>
            </div>

            <!-- Submit -->
            <div class="flex justify-end gap-2 mt-6">
                <a th:href="@{/dashboard/profile}" class="py-3 px-4 inline-flex items-center gap-x-2 text-sm font-medium rounded-lg border border-gray-200 bg-white text-gray-800 shadow-2xs hover:bg-gray-50 focus:outline-hidden focus:bg-gray-50 disabled:opacity-50 disabled:pointer-events-none ">
                    Cancel
                </a>
                <button type="submit"
                        class="py-3 px-4 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 focus:outline-none">
                    Save Changes
                </button>
            </div>

        </form>
    </div>
</main>
</body>
</html>